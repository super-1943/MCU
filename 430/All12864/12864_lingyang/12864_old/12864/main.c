/**********************************************************************
名称：凌阳501液晶驱动程序
作者：赵永科
日期：2009-07-20
*********************************************************************/
#include "msp430x15x.h"

/*
驱动口说明：
该宏在移植时需要改动
P4口为数据总线   DB0~DB7
P5口的1，3，5，7线为控制线 RESET,A0,RW,EP
*/
#define DataBus P4OUT
#define InBus   P4IN
#define RESET  P5OUT&=~0x02;
#define NoRESET P5OUT|=0x02;
#define IsData P5OUT|=0x08;
#define IsComd P5OUT&=~0x08;
#define IsRead P5OUT|=0x20;
#define IsWrite P5OUT&=~0x20;
#define E_1 P5OUT|=0x80;
#define E_0 P5OUT&=~0x80;

//以下为标准常量宏定义，可以直接移植到其他单片机
#define DisplayOn 0xaf
#define DisplayOff 0xae
#define		M_LCD_VDD_SET	M_LCD_SETR_5		//3.3V供电时选此二项
#define		M_LCD_VDD	M_LCD_BIAS_9		//....
//#define	M_LCD_VDD_SET	M_LCD_SETR_4	//5.0V供电时选此二项
//#define	M_LCD_VDD	M_LCD_BIAS_9	//...


//LCD开关命令
#define		M_LCD_ON		0x00af
#define		M_LCD_OFF		0x00ae
//设置上电控制模式
#define		M_LCD_POWER_BC	0x002c
#define		M_LCD_POWER_VR	0x002a
#define		M_LCD_POWER_VC	0x0029
#define		M_LCD_POWER_ALL	0x002f
//V5内部电压调节电阻设置……
#define		M_LCD_SETR_0	0x0020
#define		M_LCD_SETR_1	0x0021
#define		M_LCD_SETR_2	0x0022
#define		M_LCD_SETR_3	0x0023
#define		M_LCD_SETR_4	0x0024
#define		M_LCD_SETR_5	0x0025
#define		M_LCD_SETR_6	0x0026
#define		M_LCD_SETR_7	0x0027
//...end
#define		M_LCD_ELE_VOL	0x0081		//电量设置模式（显示亮度）
//偏压设置
#define		M_LCD_BIAS_9	0x00a2		//V5时选此选项设置
#define		M_LCD_BIAS_7	0x00a1		//V3时选此选项设置
//Com 扫描方式设置命令
#define		M_LCD_COM_NOR	0x00c0		//正常方式
#define		M_LCD_COM_REV	0x00c8		//反相
//Segment方向选择
#define		M_LCD_SEG_NOR	0x00a0		//正常
#define		M_LCD_SEG_REV	0x00a1		//反向
//全屏点亮/变暗指令
#define		M_LCD_ALL_LIGNT	0x00a5		//LCD ALL paint ON
#define		M_LCD_ALL_LOW	0x00a4		//Normal Display mode
//正相反相显示控制指令，RAM中数据不变
#define		M_LCD_ALL_NOR	0x00a6		//正相
#define		M_LCD_ALL_REV	0x00a7		//反相
//静态指示器控制指令
#define		M_LCD_STATIC_ON	0x00ad		//ON
#define		M_LCD_STATIC_OFF 0x00ac		//OFF
//设置显示起始行对应RAM行号
#define		M_LCD_BEGIN_LINE 0x0040		//基数，后面可加的尾数可为0~63
//设置当前页基数
#define		M_LCD_COL_PAGE	0x00b0		//基数指令，后可加尾数0~8
//设置当前列基数
#define		M_LCD_COL_LINE_LOW	0x0004		//基数指令，低四位有效
#define		M_LCD_COL_LINE_HIG	0x0010		//基数指令，低四位有效
//========================================================================//
//API接口函数宏定义
//========================================================================//
/////-----       屏幕尺寸	    -----/////
#define SCR_MAX_COL		128	
#define SCR_MAX_ROW		64						
//#define TEXT_MAX_COL	20
//#define TEXT_MAX_ROW	4

/////-----       电源模式	    -----/////
#define PWR_ON			0x0001					
#define	PWR_OFF			0x0000
#define PWR_SLEEP		0x0002
#define PWR_STDBY		0x0003

/////-----       图形显示模式	    -----/////
#define PAINT_COVER		0
#define PAINT_SET		1
#define PAINT_CLR		2
#define PAINT_REV		3
#define PAINT_RECO		4

#define PAINT_HOLLOW	0
#define PAINT_SOLID	1

//以下为数组内容
unsigned int i,j,stat;
const unsigned char table1[]=
{
/*--  调入了一幅图像：C:\Documents and Settings\Student\My Documents\我也爱电脑.bmp  --*/
/*--  宽度x高度=101x46  --*/
/*--  高度不是8的倍数，现调整为：宽度x高度=101x48  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xFF,0x01,0x01,0xF9,0xFA,0xFA,0xFA,0xF2,0xF4,0xF4,0xF4,
0xE4,0xE8,0xE8,0xE8,0xC8,0xD0,0xD0,0xD0,0x90,0xA0,0xA1,0xA1,0x21,0x41,0x42,0x42,
0xC2,0x22,0x24,0x14,0x14,0x0C,0xFC,0x44,0x48,0x48,0x48,0x48,0x50,0x50,0x50,0x60,
0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x50,0x50,0x50,0xF0,
0x48,0x40,0xF8,0x40,0x48,0x50,0x40,0x00,0x00,0x00,0xF0,0x80,0x80,0xF8,0x40,0x40,
0x20,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x80,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x04,0x24,0x22,0x3F,0x12,0x11,0x0B,0x0C,0x12,0x21,0x38,0x00,0x01,0x01,0x3F,
0x20,0x20,0x2F,0x20,0x22,0x24,0x23,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x40,0x3F,
0x10,0x90,0x57,0x67,0x2F,0xEF,0x6F,0xCF,0x5F,0x5F,0x5F,0x9F,0xBF,0xBF,0xBF,0x3F,
0x7F,0x7F,0x7F,0x7F,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x80,
0xFF,0x10,0x10,0x08,0x04,0x84,0x82,0x42,0x43,0x22,0x24,0x14,0x14,0x8C,0xF8,0x40,
0x40,0x40,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0xA8,0xA8,0xB8,
0xE8,0xB8,0xA4,0xB4,0xAC,0xA4,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x40,0x40,0x40,0x80,0x00,0x00,0x00,0xC0,0x30,
0x88,0x06,0x01,0x10,0x28,0x10,0x00,0x38,0x24,0x24,0x1D,0xC1,0x21,0xA1,0x5E,0x12,
0xF4,0x24,0x54,0xA4,0x49,0x49,0x49,0x49,0x92,0x92,0x92,0x92,0x24,0x24,0x24,0xE7,
0x12,0x12,0x89,0x89,0x44,0x44,0x22,0x22,0x11,0x91,0x88,0x88,0x84,0x44,0x42,0x42,
0x41,0x21,0x20,0x20,0x10,0x08,0x04,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x10,0x10,0x08,0x14,0x17,0x0A,0x0A,0x16,0x12,0x10,0x10,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x40,0xA0,0xA0,0x10,0x20,0xC0,0x1F,0xE0,0x00,0x18,0xE0,0x00,
0xE3,0x1C,0x03,0x10,0x29,0x92,0x01,0x20,0x52,0x25,0x02,0xC0,0x30,0x0C,0x02,0x81,
0x61,0x01,0x01,0x02,0xFD,0x14,0x12,0x11,0x14,0x21,0x24,0x21,0x28,0x42,0x28,0x22,
0x10,0x95,0x49,0x49,0x25,0x27,0x91,0x90,0x50,0x50,0x30,0x0C,0x02,0x01,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFC,0x94,0x94,0x94,0xFF,0x94,0x94,0x94,0xFE,0x04,0x00,0x00,0xFE,0x4A,0xFE,
0x04,0xF4,0xA5,0x46,0xB4,0x04,0xF4,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x04,0x09,
0x12,0x17,0x10,0x10,0x0B,0x1F,0x20,0x00,0x00,0x01,0x02,0x01,0x00,0x00,0x04,0x23,
0x20,0x10,0x1C,0x13,0x11,0x10,0x10,0x16,0x15,0x14,0x14,0x14,0x24,0x22,0x22,0x36,
0x2A,0x08,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x04,0x06,
0x00,0x06,0x01,0x04,0x07,0x00,0x07,0x04,0x04,0x05,0x04,0x07,0x00,0x00,
};
const unsigned char table2[]=
{
  /*--  调入了一幅图像：C:\Documents and Settings\Student\My Documents\我把妹妹弄丢了.bmp  --*/
/*--  宽度x高度=101x46  --*/
/*--  高度不是8的倍数，现调整为：宽度x高度=101x48  --*/
0x00,0x00,0x00,0x00,0xB0,0xD8,0xF8,0xFC,0xFE,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x07,0xFF,0x3F,0x0F,0x1F,
0x7F,0xFF,0xFF,0xFF,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDB,0x32,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xBC,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0xFF,0xFF,0x03,0x9F,0xBF,0xE7,0x80,0x83,0x8F,0x80,
0xC0,0x60,0x86,0x0E,0x44,0xBC,0xC9,0x5F,0xC7,0x40,0x2F,0x33,0x28,0x4B,0x87,0x03,
0xFF,0xFF,0x3F,0x27,0x0F,0x00,0x00,0x00,0x00,0x28,0x28,0x28,0xF8,0x24,0xA0,0xFC,
0x20,0x24,0xA8,0x20,0x00,0x10,0x90,0xFC,0x50,0x10,0xF8,0x88,0xF8,0x88,0x88,0xF8,
0x00,0x10,0xF0,0x1C,0xF0,0x40,0x50,0x50,0xFC,0x50,0x58,0x50,0x00,0x10,0xF0,0x1C,
0xF0,0x40,0x50,0x50,0xFC,0x50,0x58,0x50,0x00,0x00,0x00,0x11,0xDD,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x43,0xB0,0x63,0x08,0x81,0x0C,0x02,
0x41,0x80,0x8C,0x8C,0x40,0x40,0x21,0x00,0x20,0x00,0x09,0x50,0xA1,0x88,0x50,0x53,
0x33,0x30,0x68,0xDD,0x90,0x2F,0xF5,0x04,0xF8,0x00,0x00,0x00,0x00,0x00,0x02,0x12,
0x11,0x1F,0x09,0x08,0x05,0x06,0x09,0x10,0x1C,0x00,0x11,0x10,0x1F,0x00,0x00,0x1F,
0x10,0x10,0x10,0x10,0x1C,0x00,0x13,0x0A,0x04,0x0B,0x04,0x02,0x01,0x1F,0x02,0x04,
0x08,0x00,0x13,0x0A,0x04,0x0B,0x04,0x02,0x01,0x1F,0x02,0x04,0x08,0x00,0x00,0x00,
0x00,0x01,0x00,0x03,0x1F,0x0F,0xFF,0x0F,0x77,0x0B,0xAB,0x5B,0x67,0xDC,0x20,0xF8,
0x06,0xF9,0xCC,0x8E,0xA3,0xC3,0x57,0xE3,0x21,0x23,0x23,0x11,0x11,0x11,0x89,0x89,
0x89,0x84,0xC4,0xC4,0xC4,0x42,0x63,0x66,0x33,0x3F,0x9C,0x60,0x1F,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x44,0x54,0xD4,0x54,0x7C,0x54,0xD4,0x54,
0x44,0x40,0x00,0x00,0x28,0x28,0x28,0x28,0xF8,0x24,0x24,0x24,0x24,0x00,0x00,0x00,
0x04,0x04,0x04,0x04,0xE4,0x24,0x14,0x0C,0x04,0x00,0x00,0x00,0x70,0xF8,0xF8,0x70,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC1,0x32,0x1C,0x0D,
0x0D,0x0E,0x07,0x05,0x0C,0x1F,0x10,0x27,0x69,0xD8,0xD9,0xDC,0xDE,0xDC,0x4C,0x27,
0x22,0x23,0x21,0x20,0x20,0xA2,0xE1,0xF0,0xF2,0x90,0x09,0x0A,0x14,0x62,0x81,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x12,0x12,0x0A,0x07,
0x02,0x02,0x02,0x1F,0x02,0x02,0x02,0x00,0x01,0x11,0x19,0x15,0x13,0x11,0x11,0x15,
0x19,0x11,0x01,0x00,0x00,0x00,0x00,0x10,0x10,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x0D,0x0D,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x10,0x09,0x0F,
0x0F,0x3F,0x3F,0x3F,0x3E,0x3C,0x38,0x38,0x30,0x37,0x32,0x3F,0x3F,0x3F,0x3F,0x3E,
0x00,0x20,0x10,0x11,0x1E,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
const unsigned char table3[]=
{
  /*--  调入了一幅图像：C:\Documents and Settings\Student\My Documents\爽.bmp  --*/
/*--  宽度x高度=101x46  --*/
/*--  高度不是8的倍数，现调整为：宽度x高度=101x48  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x60,0xE0,0xE0,0x70,0x7C,0xFC,0xFC,
0xFC,0xF8,0xF8,0xF8,0xF8,0xF8,0xB8,0x38,0x00,0x00,0x00,0x00,0x10,0xF8,0xFC,0xF8,
0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x40,0x40,0x40,0x40,0x40,0x40,0x80,0x80,0xC0,0x60,0xB0,0x98,0x18,0x3C,0x7C,
0x3E,0x3E,0x3F,0x3F,0x3F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,
0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x83,0x9C,0x78,0xF5,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xD1,0xF5,0xFF,0x7F,
0xF7,0xE7,0xFE,0xFF,0xFF,0xFF,0xE3,0xEE,0xFB,0xFD,0xBF,0x7F,0x73,0x60,0x00,0x00,
0x00,0x80,0x87,0xFF,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,
0x20,0x20,0x30,0x38,0xBF,0xAC,0x98,0xAC,0x9E,0xAF,0x9F,0x8F,0x8E,0x8C,0x0F,0x1E,
0x1B,0x11,0x10,0xB3,0x73,0xF0,0xF0,0xF8,0xF8,0xFC,0xFE,0x7F,0xFF,0xEF,0xEF,0xEF,
0xCF,0x1F,0x1F,0xFF,0xE7,0xE1,0xF0,0xF0,0x50,0xE8,0xF8,0xF8,0xF8,0xFC,0xFC,0xFC,
0xC6,0xF2,0xF3,0xF1,0xF9,0xFD,0xFE,0xFF,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x04,0x0E,0x0F,0x0F,0x0F,0x07,0x03,0x00,0x00,0x00,0x01,0x03,0x07,0x0F,
0x0F,0x0E,0x00,0x00,0x00,0x00,0x00,0x03,0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x03,0x06,0x06,0x07,0x07,0x0F,0x0F,0x1F,0x7F,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFC,0xF8,0xE0,0x01,0x0A,0xFF,0xFF,0xFF,0xFF,0xFF,
0xF8,0xF6,0xFF,0xFF,0xF7,0xFB,0xFC,0xFE,0xFF,0xFF,0xFF,0xFF,0x7F,0xFF,0x7F,0x3F,
0x3F,0x1F,0x1F,0x0F,0x0F,0x07,0x07,0x03,0x03,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x04,0x0E,0x0A,0x0A,0x0A,0x09,0x09,0x19,0x19,0x39,0xB9,
0xB8,0xF2,0xB2,0xC2,0x54,0x78,0x48,0x44,0x44,0x82,0x02,0x02,0x03,0x01,0x01,0x81,
0xC1,0xC1,0x61,0x61,0x71,0x6A,0x3C,0x00,0x00,0x00,0x00,0x00,0xC0,0x60,0x20,0x90,
0xD0,0xF0,0xF9,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x00,0xEA,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x0F,0x03,0x01,0x01,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF0,0xF8,0xFC,
0xFC,0xFC,0xFE,0xFF,0xBF,0x87,0xC1,0xE0,0xF0,0xF8,0xF4,0x7A,0x7C,0xFA,0xF4,0xBB,
0x3E,0x14,0x12,0x11,0x11,0x28,0x28,0x30,0x50,0xE0,0x80,0x00,0x00,0x00,0x00,0x00,
0x7F,0xFD,0xFE,0xFF,0xFE,0xFF,0x7F,0xFF,0x7F,0x7F,0x7F,0xBF,0xBF,0xDF,0xCF,0xE7,
0xF1,0x78,0x3E,0x1F,0x2F,0x17,0x0F,0x17,0x0F,0x3F,0x5F,0xBF,0xFF,0xFF,0xFF,0xE0,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x0F,0x3F,0x3B,0x31,0x23,0x05,0x2B,0x17,0x3F,0x3D,0x30,0x20,0x30,0x2B,0x37,
0x3E,0x3C,0x3E,0x3F,0x3F,0x3F,0x38,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x0F,
0x00,0x00,0x00,0x00,0x00,0x20,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,
0x3F,0x3F,0x3F,0x3F,0x3F,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
0x2A,0x15,0x3F,0x3F,0x3F,0x3E,0x38,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

//函数声明
void init_lcd(void);
void send_cmd(unsigned char cmd);
void send_data(unsigned char d);
void delay(unsigned int t);
unsigned char read_stat(void);
unsigned char read_data(void);
void set_pos(unsigned char x,unsigned char y);
void clear(void);
void show_picture(const unsigned char * tab,unsigned char width,unsigned char _8_height);



//主函数
int main( void )
{
  // Stop watchdog timer to prevent time out reset
  WDTCTL = WDTPW + WDTHOLD;
  RESET;
  delay(10000);
  NoRESET;
  init_lcd();
  clear();
  delay(60000);
//  clear();
  while(1)
  {
    show_picture(table1,101,48);
    for(i=0x40;i<0x80;i++)
    {
      delay(10000);
      send_cmd(i);
    }
    delay(60000);
    show_picture(table2,101,48);
    for(i=0x40;i<0x80;i++)
    {
      delay(10000);
      send_cmd(i);
    }
    delay(60000);
    show_picture(table3,101,48);
    for(i=0x40;i<0x80;i++)
    {
      delay(10000);
      send_cmd(i);
    }
    delay(60000);  
  }

}


//向12864发送命令，参数即为命令
void send_cmd(unsigned char cmd)
{
  E_0;
  _NOP();
  IsWrite;
  IsComd;
  _NOP();  
  E_1;
  delay(1);
  DataBus=cmd;
  delay(1);
  E_0;
  
}



//向12864发送点阵数据
void send_data(unsigned char d)
{
  E_0;
  _NOP();
  IsWrite;
  IsData;
  _NOP();  
  E_1;
  _NOP();
  DataBus=d;
  _NOP();
  _NOP();
  E_0;
}

//初始化12864
void init_lcd(void)
{
  P4DIR=0xff;
  P4OUT=0x0f;
  P2DIR=0x10;
  P5DIR=0xaa;
  delay(3000);
  send_cmd(M_LCD_ON);
  stat=read_stat();
  send_cmd(M_LCD_POWER_ALL);  
  stat=read_stat();
  send_cmd(M_LCD_ELE_VOL);  
  stat=read_stat();
  send_cmd(0x12);
  stat=read_stat();
  send_cmd(M_LCD_VDD_SET);
  stat=read_stat();
  send_cmd(M_LCD_COM_NOR);
  stat=read_stat();  
  clear();
/*  unsigned char x,y;
  for(y=0;y<6;y++)
  {
    set_pos(0,y);
    for(x=0;x<101;x++)
    {
      send_data(table[y*101+101-1-x]);
      stat=read_stat();
    }
  }
  */
}
//延时
void delay(unsigned int t)
{
  while(t--);
}
//读状态字
unsigned char read_stat(void)
{
  unsigned char t;
  P4DIR=0x00;
  P4OUT=0xff;
  E_0;
  IsComd;
  IsRead;
  _NOP();
  E_1;
  _NOP();
  E_0;
  t=P4IN;
  P4DIR=0xff;
  return t;
}

//读数据
unsigned char read_data(void)
{
  unsigned char t;
  P4DIR=0x00;
  P4OUT=0xff;
  E_0;
  IsData;
  IsRead;
  _NOP();
  E_1;
  _NOP();
  E_0;
  t=P4IN;
  P4DIR=0xff;
  return t;
}
//设置点阵数据地址
void set_pos(unsigned char x,unsigned char y)
{
  unsigned char tmp;
  y&=0x0f;
  tmp=0xb0;
  tmp|=y;
  send_cmd(tmp);
  stat=read_stat();
  tmp=0x10;
  tmp|=(x>>4);
  send_cmd(tmp);
  stat=read_stat();
  x&=0x0f;
  send_cmd(x);
  stat=read_stat();
}

//清屏
void clear(void)
{
  unsigned char x,y;
  for(y=0;y<8;y++)
  {
    set_pos(0,y);
    stat=read_stat();
    for(x=0;x<128;x++)
    {
      send_data(0x00);
      stat=read_stat();
    }
  }
}

//显示图片
//参数：
//tab:点阵数据首地址，即数组名
//width:图片宽度，很重要！
//_8_height:点阵高度，应该为8 的倍数，否则将多出的部分切除
void show_picture(const unsigned char * tab,unsigned char width,unsigned char _8_height)
{
  unsigned char x,y;
  _8_height&=0xf8;
  clear();
  for(y=0;y<(_8_height>>3);y++)
  {
    set_pos(0,y);
    for(x=0;x<width;x++)
    {
      send_data(tab[y*width+width-x]);
      stat=read_stat();
    }
  }
}